id: agent-credential-access-001
title: Credential File Access Attempt
description: |
  Detects access to sensitive credential files including environment files,
  SSH keys, cloud provider credentials, keychain access, and environment
  variable dumping. Covers both file-read events and command-based access
  with broad binary matching.
author: AgentShield
date: "2026-01-25"
status: production
level: high
logsource:
  product: agentshield
  category: agent_events
tags:
  - attack.credential_access
  - attack.t1552
  - attack.t1555
detection:
  # Direct file reads (from Read tool / file_read events)
  selection_file_read_env:
    event_type: file_read
    file_path|endswith: '.env'
  selection_file_read_ssh:
    event_type: file_read
    file_path|contains: '.ssh/'
  selection_file_read_cloud:
    event_type: file_read
    file_path|contains:
      - '.aws/credentials'
      - '.aws/config'
      - '.config/gcloud/'
      - '.kube/config'
      - '.docker/config.json'
  # Command-based: reading .env files (broad binary matching)
  selection_cmd_env:
    event_type: tool_call
    command|contains: '.env'
    command|re: '(cat|less|head|tail|grep|cp|scp|tar|zip|mv)\s'
  # Command-based: reading SSH files
  selection_cmd_ssh:
    event_type: tool_call
    command|contains: '.ssh/'
    command|re: '(cat|less|head|tail|grep|cp|scp|tar|zip|mv)\s'
  # Command-based: cloud credentials
  selection_cmd_cloud:
    event_type: tool_call
    command|contains:
      - '.aws/credentials'
      - '.kube/config'
  # Environment variable dumping
  selection_env_dump:
    event_type: tool_call
    command|re: '^(env|printenv|set)$'
  # macOS keychain access
  selection_keychain:
    event_type: tool_call
    command|contains:
      - 'security find-generic-password'
      - 'security dump-keychain'
  condition: >
    selection_file_read_env or selection_file_read_ssh or selection_file_read_cloud
    or selection_cmd_env or selection_cmd_ssh or selection_cmd_cloud
    or selection_env_dump or selection_keychain
